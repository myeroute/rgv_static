---
import BaseLayout from "../layouts/BaseLayout.astro";
import PostCard from "../components/PostCard.astro";
import { getCollection } from "astro:content";

const query = Astro.url.searchParams.get("q") || "";

const allPosts = await getCollection("blog");

const results =
  query.length >= 2
    ? allPosts.filter((post) =>
        post.data.title.toLowerCase().includes(query.toLowerCase())
      )
    : [];
---

<BaseLayout
  title="Search"
  description="Search posts on Retro Gaming Verse"
  sidebar={null}
>
  <section class="search-page">
    <h1>Search</h1>

    <form method="get" action="/search">
      <input
        type="text"
        name="q"
        placeholder="Type to search posts..."
        value={query}
        autocomplete="off"
      />
    </form>

    {query && (
      <p class="search-meta">
        {results.length} result{results.length !== 1 && "s"} for “{query}”
      </p>
    )}

    {results.length > 0 && (
      <div class="search-results">
        {results.map((post) => (
          <PostCard {...post} />
        ))}
      </div>
    )}

    {query && results.length === 0 && (
      <p>No results found.</p>
    )}
  </section>

  <style>
    .search-page {
      max-width: 1200px;
      margin: 2rem auto 4rem;
      padding: 0 1rem;
    }

    form {
      margin-bottom: 1.5rem;
    }

    input {
      width: 100%;
      padding: 0.75rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    .search-meta {
      margin-bottom: 1.5rem;
      color: #555;
      font-size: 0.95rem;
    }

    /* Desktop: grid như category */
    .search-results {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2rem;
    }

    /* Mobile: list */
    @media (max-width: 768px) {
      .search-results {
        grid-template-columns: 1fr;
      }
    }
  </style>
</BaseLayout>
