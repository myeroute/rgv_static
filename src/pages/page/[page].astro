---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import PostCard from "../../components/PostCard.astro";

export const PAGE_SIZE = 8;

export async function getStaticPaths() {
  const posts = (await getCollection("blog")).sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
  );

  const totalPages = Math.ceil(posts.length / PAGE_SIZE);

  return Array.from({ length: totalPages }, (_, i) => ({
    params: { page: String(i + 1) },
    props: {
      posts: posts.slice(i * PAGE_SIZE, (i + 1) * PAGE_SIZE),
      currentPage: i + 1,
      totalPages,
    },
  }));
}

const { posts, currentPage, totalPages } = Astro.props;
---

<BaseLayout sidebar="home">
  <section class="home-post-list">
    {posts.map((post) => (
      <PostCard post={post} />
    ))}
  </section>

  <nav class="pagination">
    {currentPage > 1 && (
      <a href={currentPage === 2 ? "/" : `/page/${currentPage - 1}/`}>
        ← Newer
      </a>
    )}

    {currentPage < totalPages && (
      <a href={`/page/${currentPage + 1}/`}>
        Older →
      </a>
    )}
  </nav>
</BaseLayout>

<style>
.home-post-list {
  display: flex;
  flex-direction: column;
  gap: 2.5rem;
}

.pagination {
  display: flex;
  justify-content: space-between;
  margin-top: 3rem;
}

.pagination a {
  text-decoration: none;
  font-weight: 500;
}
</style>
