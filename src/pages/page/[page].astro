---
import { getCollection } from 'astro:content';

const PAGE_SIZE = 8;

export async function getStaticPaths() {
  const posts = (await getCollection('blog')).sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
  );

  const totalPages = Math.ceil(posts.length / PAGE_SIZE);

  return Array.from({ length: totalPages }, (_, i) => ({
    params: { page: String(i + 1) },
    props: {
      posts: posts.slice(i * PAGE_SIZE, (i + 1) * PAGE_SIZE),
      currentPage: i + 1,
      totalPages,
    },
  }));
}

const { posts, currentPage, totalPages } = Astro.props;
---

<h1>Latest Posts – Page {currentPage}</h1>

<ul class="post-list">
  {posts.map((post) => (
    <li class="post-item">
      <h2>
        <a href={`/${post.id}/`}>{post.data.title}</a>
      </h2>

      {post.data.description && (
        <p class="excerpt">{post.data.description}</p>
      )}

      <a class="read-more" href={`/${post.id}/`}>
        Read →
      </a>
    </li>
  ))}
</ul>

<nav class="pagination">
  {currentPage > 1 && (
    <a href={currentPage === 2 ? '/' : `/page/${currentPage - 1}/`}>
      ← Previous
    </a>
  )}

  {currentPage < totalPages && (
    <a href={`/page/${currentPage + 1}/`}>
      Next →
    </a>
  )}
</nav>

<style>
  .post-list {
    list-style: none;
    padding: 0;
    max-width: 720px;
    margin: 0 auto;
  }

  .post-item {
    margin-bottom: 3rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid #eee;
  }

  .excerpt {
    color: #555;
  }

  .pagination {
    max-width: 720px;
    margin: 3rem auto;
    display: flex;
    justify-content: space-between;
  }
</style>
