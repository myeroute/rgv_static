---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getCollection } from 'astro:content';

// LẤY TẤT CẢ BÀI
const posts = await getCollection('blog');

// sort theo ngày
posts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);
---

<BaseLayout title="Home">
  <main style="max-width: 900px; margin: 2rem auto;">
    <h1>Posts ({posts.length})</h1>

    {posts.map((post) => {
      // slug CHUẨN, không đoán
      const slug = post.id.replace(/\.mdx?$/, '').split('/').pop();

      return (
        <article style="margin-bottom: 2rem;">
          <h2>
            <a href={`/${slug}/`}>{post.data.title}</a>
          </h2>

          <p>{post.data.description}</p>

          <small>
            slug: {slug} <br />
            category: {post.data.category}
          </small>
        </article>
      );
    })}
  </main>
</BaseLayout>
